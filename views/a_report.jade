extends ./g_layout.jade
block vars
  - var page = 'report'
  - var hours_count = function(previousValue, currentValue, currentIndex, array) {if(currentValue) {return previousValue + currentValue;} else {return currentValue;} };

block head
  title Rapport de l'élèves
  meta(name='description', content='Lisez le rapport de bénévolat de l\'élèves')
block content
  #map-section.container-fluid
    .row
      .col-md-3.col-md-offset-1
        .page-header
          h3
            | Profil de l'élève
            small
          if error
            p.alert.alert-danger #{error}
        ul.list-group
          li.list-group-item
            | Prénom: #{volunteer.firstname}
            small
          li.list-group-item
            | Nom: #{volunteer.lastname}
            small
          li.list-group-item
            | Date de naissance: #{volunteer.birthdate}
            small
          li.list-group-item
            | Adresse mail: #{volunteer.email}
            small
      .col-md-6.col-md-offset-1
        .page-header
          h3 Bilan
        table.table.table-stripped
          tr
            th
            th.text-center Inscriptions
            th.text-center Heures
          tr
            th(rowspan='2' style="vertical-align:middle").text-center Engagements
            td(rowspan='2' style="vertical-align:middle").text-center <strong> #{volunteer.long_terms.length} </strong>
            td.text-center <strong>#{volunteer.long_terms.filter(function(long){if(long.hours_pending){return true;}else{return false;}}).map(el => el.hours_pending).reduce(hours_count, 0)}</strong> heures à confirmer
          tr
            td.text-center(style="vertical-align:middle")  <strong>#{volunteer.long_terms.filter(function(long){if(long.hours_done){return true;}else{return false;}}).map(el => el.hours_done).reduce(hours_count, 0)}</strong>  heures confirmées
          tr
            th(rowspan='2' style="vertical-align:middle").text-center Évènements ponctuels
            td(rowspan='2' style="vertical-align:middle").text-center <strong> #{volunteer.events.length} </strong>
            td.text-center <strong>#{volunteer.events.filter(function(ev){if(ev.hours_pending){return true;}else{return false;}}).map(el => el.hours_pending).reduce(hours_count, 0)}</strong> heures à confirmer
          tr
            td.text-center(style="vertical-align:middle")  <strong>#{volunteer.events.filter(function(ev){if(ev.hours_done){return true;}else{return false;}}).map(el => el.hours_done).reduce(hours_count, 0)}</strong>  heures confirmées
          tr
            th(rowspan='2' style="vertical-align:middle").text-center Extras ajoutés par l'élève
            td(rowspan='2' style="vertical-align:middle").text-center <strong> #{volunteer.extras.length} </strong>
            td.text-center <strong>#{volunteer.extras.filter(function(ev){if(ev.hours_pending){return true;}else{return false;}}).map(el => el.hours_pending).reduce(hours_count, 0)}</strong> heures à confirmer
          tr
            td.text-center(style="vertical-align:middle")  <strong>#{volunteer.extras.filter(function(ev){if(ev.hours_done){return true;}else{return false;}}).map(el => el.hours_done).reduce(hours_count, 0)}</strong>  heures confirmées
          tr.success
            th.text-center Total
            td.text-center <strong> #{volunteer.events.length + volunteer.long_terms.length + volunteer.extras.length} </strong>
            td.text-center <strong> #{volunteer.events.filter(function(ev){if(ev.hours_done){return true;}else{return false;}}).map(el => el.hours_done).reduce(hours_count, 0) + volunteer.long_terms.filter(function(long){if(long.hours_done){return true;}else{return false;}}).map(el => el.hours_done).reduce(hours_count, 0) + volunteer.extras.filter(function(extra){if(extra.hours_done){return true;}else{return false;}}).map(el => el.hours_done).reduce(hours_count, 0)} heures totales confirmées</strong>


    .row
      .col-md-10.col-md-offset-1(style='border: 3px solid #5BCF8F; margin-bottom:10px;')
        .page-header
          h3 ACTIVITÉS
        .no-side-padding
            ul.list-group.list-opportunity
              unless (events)
                p.alert.alert-danger Aucune activité
              each event, index in events
                if event.status != 'gathered'
                  li.list-group-item
                    div.media-left
                      h4.media-heading Status
                      if ((event.hours_pending == 0) && (event.hours_done != 0))
                        p Confirmé
                      else if (event.hours_pending > 0)
                        p Attente de validation par l'organisme
                      else if event.status == 'past'
                        p Passé, à valider par l'élève
                      else if event.status == 'subscribed'
                        p Inscrit, à venir
                      else
                        p.alert.alert-danger Indéfini
                    div.media-body
                      h4.media-heading= 'Organisme : ' + event.org_name
                      a.firstColor= 'Évènement : ' + event.intitule
                      h6= event.description_event
                      h6= event.day.toLocaleDateString()
                      h6= 'Adresse : ' + event.address
                      if event.hours_done > 0
                        p= event.hours_done + ' heures confirmées par l\'organisme'
                      if event.hours_pending > 0
                        p= event.hours_pending + ' heures en attente de confirmation par l\'organisme'
                      #identifiant(style='display:none')
                        p= event._id
                      if event.student_answers.length > 0
                        div.panel.panel-default
                          div.panel-heading
                            h4 Retour de l’élève sur lui-même 
                          div.panel-body
                              each question, q_I in event.student_questions
                                div.panel.panel-warning
                                  div.panel-heading
                                    h6= question
                                  div.panel-body
                                    h6= event.student_answers[q_I]
                      if event.organism_answers.length > 0
                        div.panel.panel-default
                          div.panel-heading
                            h4 Retour de l'organisme sur l'élève
                          div.panel-body
                              each question, q_I in event.organism_questions
                                div.panel.panel-success
                                  div.panel-heading
                                    h6= question
                                  div.panel-body
                                    h6= event.organism_answers[q_I]
    .row
      .col-md-10.col-md-offset-1(style='border: 3px solid #359B9C; margin-bottom:10px;')
        .page-header
          h3 ENGAGEMENTS
        .no-side-padding
          ul.list-group.list-opportunity
            unless (volunteer.long_terms)
              p.alert.alert-danger Aucun engagement
            if (volunteer.long_terms)
              table.table.table-striped
                tr
                  th Informations
                  th Retours
                each lt, lt_i in volunteer.long_terms
                  tr
                    td
                      if (lt.hours_pending > 0 || lt.hours_done > 0)
                        if (lt.hours_pending > 0)
                          span.badge(style='background-color: #E33831')= lt.hours_pending + ' heures à confirmer'
                        if (lt.hours_done > 0)
                          span.badge(style='background-color: #113A20')= lt.hours_done + ' heures réalisées'
                      else 
                        span.badge(style='background-color: #E33831')= 'Aucune heure enregistrée'
                      h4= lt.intitule
                      h6 pour <strong> #{lt.org_name} </strong>
                      if (lt.hours_pending > 0 || lt.hours_done > 0)
                        h6= lt.description
                    td
                      unless (lt.hours_pending > 0 || lt.hours_done > 0)
                        h6= lt.description
                      if lt.student_answers.length > 0
                        div.panel.panel-default
                          div.panel-heading
                            h4 Retour de l’élève sur lui-même 
                          div.panel-body
                              each question, q_I in lt.student_questions
                                div.panel.panel-warning
                                  div.panel-heading
                                    h6= question
                                  div.panel-body
                                    h6= lt.student_answers[q_I]
                      if lt.organism_answers.length > 0
                        div.panel.panel-default
                          div.panel-heading
                            h4 Retour de l'organisme sur l'élève
                          div.panel-body
                              each question, q_I in lt.organism_questions
                                div.panel.panel-success
                                  div.panel-heading
                                    h6= question
                                  div.panel-body
                                    h6= lt.organism_answers[q_I]
    .row
      .col-md-10.col-md-offset-1(style='border: 3px solid #E56252; margin-bottom:10px;')
        .page-header
          h3 Les extras ajoutés par l'élève
        .no-side-padding
          ul.list-group.list-opportunity
            unless (volunteer.extras)
              p.alert.alert-danger Aucune heure extra-Simplyk
            if (volunteer.extras)
              table.table.table-striped
                tr
                  th Informations
                  th Retours
                each ext, ext_i in volunteer.extras
                  tr
                    td
                      if (ext.hours_pending > 0 || ext.hours_done > 0)
                        if (ext.hours_pending > 0)
                          span.badge(style='background-color: #E33831')= ext.hours_pending + ' heures à confirmer'
                        if (ext.hours_done > 0)
                          span.badge(style='background-color: #113A20')= ext.hours_done + ' heures réalisées'
                      else 
                        span.badge(style='background-color: #E33831')= 'Aucune heure enregistrée'
                      h4= ext.intitule
                      h6 pour <strong> #{ext.org_name} </strong>
                      if (ext.hours_pending > 0 || ext.hours_done > 0)
                        h6= ext.description
                    td
                      unless (ext.hours_pending > 0 || ext.hours_done > 0)
                        h6= ext.description
                      if ext.student_answers.length > 0
                        div.panel.panel-default
                          div.panel-heading
                            h4 Retour de l’élève sur lui-même 
                          div.panel-body
                              each question, q_I in ext.student_questions
                                div.panel.panel-warning
                                  div.panel-heading
                                    h6= question
                                  div.panel-body
                                    h6= ext.student_answers[q_I]
                      if ext.organism_answers.length > 0
                        div.panel.panel-default
                          div.panel-heading
                            h4 Retour de l'organisme sur l'élève
                          div.panel-body
                              each question, q_I in ext.organism_questions
                                div.panel.panel-success
                                  div.panel-heading
                                    h6= question
                                  div.panel-body
                                    h6= ext.organism_answers[q_I]