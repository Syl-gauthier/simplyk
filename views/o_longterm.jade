extends ./g_layout.jade
block vars
  - var page = 'longterm'
  - var days_name = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi']
  - var months_name = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre']
  - function correctDate(date){var tz_offset = (new Date()).getTimezoneOffset() * 60 * 1000;var corrected_datetime = new Date(date.getTime() + tz_offset);return corrected_datetime}
block head
  title Bénévoles à long terme
  meta(name='description', content='Gère tes bénévoles inscrits à long terme')
block content
  .container-fluid
    .row
      .col-md-6.col-md-offset-3
        .page-header
          h1.inline.intitule #{longterm.intitule}
          i.fa.fa-pencil.fa-xs.edit(style="cursor: pointer" type='intitule')
          if (error)
            p.alert.alert-danger= error
          p #{longterm.description} <i class="fa fa-pencil edit" type='description' style="cursor: pointer"></i>
          p <b>#{longterm.vol_nb}</b> bénévoles recherchés <i class="fa fa-pencil edit" type='vol_nb' style="cursor: pointer"></i>
          p <b>Expiration de l'offre : </b> #{date.printDate(longterm.expiration_date)}
          if longterm.min_age
            p <b>Âge minimal : </b> #{longterm.min_age}
          p <b>Adresse : </b> #{longterm.address}
            li.list-group-item
              div.media-left.media-middle
                i.fa.fa-calendar
              div.media-body
                h4 Disponibilités 
                table.table(id='slot')
                  thead
                    tr
                      th.text-center #
                      th.text-center Lundi
                      th.text-center Mardi
                      th.text-center Mercredi
                      th.text-center Jeudi
                      th.text-center Vendredi
                      th.text-center Samedi
                      th.text-center Dimanche
                  tbody
                    tr
                      th(scope='row') AM
                      td.text-center
                        if slotJSON['mondayAM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['tuesdayAM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['wednesdayAM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['thursdayAM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['fridayAM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['saturdayAM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['sundayAM']
                          i.fa.fa-check
                        else
                          p
                    tr
                      th(scope='row') PM
                      td.text-center
                        if slotJSON['mondayPM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['tuesdayPM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['wednesdayPM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['thursdayPM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['fridayPM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['saturdayPM']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['sundayPM']
                          i.fa.fa-check
                        else
                          p
                    tr
                      th(scope='row')= 'Soir (>16h)'
                      td.text-center
                        if slotJSON['mondayEVE']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['tuesdayEVE']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['wednesdayEVE']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['thursdayEVE']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['fridayEVE']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['saturdayEVE']
                          i.fa.fa-check
                        else
                          p
                      td.text-center
                        if slotJSON['sundayEVE']
                          i.fa.fa-check
                        else
                          p
    .row
      .col-md-10.col-md-offset-1
        .panel.panel-default(style='margin-bottom: 60px;')
          .panel-heading
            .panel-title
              h1 Bénévoles inscrits
          .panel-body
            table.table.table-striped(id='subscribers')
              thead
                tr
                  th.text-center #
                  th.text-center Nom
                  th.text-center Prénom
                  th.text-center
                    i.fa.fa-birthday-cake
                  th.text-center
                    i.fa.fa-phone
                  th.text-center Courriel
                  th.text-center Participation / À confirmer
              tbody
                each vol, vol_i in volunteers
                  tr
                    td.text-center= vol_i
                    td.text-center= vol.lastname
                    td.text-center= vol.firstname
                    if vol.birthdate
                      td.text-center #{(correctDate(vol.birthdate).getDate()) + ' ' + months_name[correctDate(vol.birthdate).getMonth()]  + ' ' + correctDate(vol.birthdate).getFullYear()}
                    else
                      td
                    if vol.phone
                      td.text-center= vol.phone
                    else 
                      td.text-center
                    td.text-center= vol.email
                    td.text-center
                      if typeof vol.long_terms[0].hours_done !== 'undefined'
                        span.badge.inline(style='background-color: #113A20')= vol.long_terms[0].hours_done + 'h'
                      else
                        span.badge.inline(style='background-color: #113A20')= '0h'
                      h4.inline <b>/</b>
                      if typeof vol.long_terms[0].hours_pending !== 'undefined'
                        span.badge.inline(style='background-color: #E33831')= vol.long_terms[0].hours_pending + 'h'
                      else
                        span.badge.inline(style='background-color: #E33831')= '0h'

block footscript
  script(type='text/javascript').
    'use strict';
    $(document).ready(function(){
      $('.edit').click(function(){
        const type = $(this).attr('type');
        if(type == 'vol_nb'){
          let div = $(this).parent();
          div.html("<form name='edit-form' method='post' action='/edit-longterm'><p>Nombre de bénévoles recherchés</p><input type='number' min='1' max='400' name='vol_nb'></input><input class='hidden' name='url' value="+window.location.pathname+"></input><input type='submit' value='Modifier'></input></form>");
        } else if (type == 'description'){
          let div = $(this).parent();
          div.html("<form name='edit-form' method='post' action='/edit-longterm'><p>Nouvelle description</p><textarea rows='6' name='description'></textarea><input class='hidden' name='url' value="+window.location.pathname+"></input><input type='submit' value='Modifier'></input></form>");
        } else if (type == 'intitule'){
          let div = $('h1.intitule');
          div.html("<form name='edit-form' method='post' action='/edit-longterm'><p>Nouveau titre</p><input type='text' name='intitule'></input><input class='hidden' name='url' value="+window.location.pathname+"></input><input type='submit' value='Modifier'></input></form>");
        }
      })
    });